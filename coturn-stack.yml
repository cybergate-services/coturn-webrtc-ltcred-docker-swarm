version: '3.7'
services:
  coturn:
    image: '127.0.0.1:5000/coturn-master'
    ports:
      - "3478:3478/udp" 
      - "3478:3478/tcp"
    environment:
      - TURN_PORT=3478
      - TURN_PORT_START=10000
      - TURN_PORT_END=20000
      - TURN_SECRET=mysecret
      - TURN_SERVER_NAME=coturn
      - TURN_REALM=teams.cyber.lk
      - ALTERNATE-SERVER1=coturn1.teams.cyber.lk
      - ALTERNATE-SERVER3=coturn2.teams.cyber.lk
      - ALTERNATE-SERVER1=coturn3.teams.cyber.lk
    deploy:
      placement:
        constraints:
          - node.hostname == node4          
     networks:
      - host
  coturn1:
    image: '127.0.0.1:5000/coturn-slave'
    ports:
      - "3478:3478/udp" 
      - "3478:3478/tcp"
    environment:
      - TURN_PORT=3478
      - TURN_PORT_START=10000
      - TURN_PORT_END=20000
      - TURN_SECRET=mysecret
      - TURN_SERVER_NAME=coturn1
      - TURN_REALM=teams.cyber.lk
    deploy:
      placement:
        constraints:
          - node.hostname == node1          
     networks:
      - host
  coturn2:
    image: '127.0.0.1:5000/coturn-slave'
    ports:
      - "3478:3478/udp" 
      - "3478:3478/tcp"
    environment:
      - TURN_PORT=3478
      - TURN_PORT_START=10000
      - TURN_PORT_END=20000
      - TURN_SECRET=mysecret
      - TURN_SERVER_NAME=coturn2
      - TURN_REALM=teams.cyber.lk
    deploy:
      placement:
        constraints:
          - node.hostname == node2          
     networks:
      - host
  coturn3:
    image: '127.0.0.1:5000/coturn-slave'
    ports:
      - "3478:3478/udp" 
      - "3478:3478/tcp"
    environment:
      - TURN_PORT=3478
      - TURN_PORT_START=10000
      - TURN_PORT_END=20000
      - TURN_SECRET=mysecret
      - TURN_SERVER_NAME=coturn3
      - TURN_REALM=teams.cyber.lk
    deploy:
      placement:
        constraints:
          - node.hostname == node3          
     networks:
      - host 
  
networks:
  host:
    external: true
   

